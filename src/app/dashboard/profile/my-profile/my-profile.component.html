<div *ngIf="me">
  <div class="grid grid-cols-12 gap-4">
    <div class="col-span-12 lg:col-span-12 my-4 p-3 bg-black-violet-orange-180-05 main-violet-first-rounded shadow-2xl rounded-lg max-h-[600px]">
      <div class="flex items-center my-2">
        <div class="rounded-full w-[130px] h-[130px] md:w-[180px] md:h-[180px] bg-center bg-no-repeat bg-cover relative main-violet-first-rounded"
             [ngStyle]="{'background-image':'url('+ ImageHelper.getImage(me.file?.url) +')'}">
          <div class="absolute bottom-[20px] flex justify-center w-full">
            <form>
              <input id="img-update" (change)="onFileSelected($event)" type="file" class="invisible w-0" accept="image/*"/>
            </form>
            <label for="img-update">
              <fa-icon class="mr-2 text-white text-2xl cursor-pointer hover:" [icon]="faCameraAlt"></fa-icon>
            </label>
          </div>
        </div>
        <p class="block mb-2 text-xl md:text-2xl lg:text-3xl font-bold text-white ml-3">{{me.name}}</p>
      </div>
      <div *ngIf="me" class="px-3 py-4 grid grid-cols md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 2xl:grid-cols-6 gap-2">

        <span class="mb-2 text-sm md:text-md lg:text-lg font-normal main-violet-first-rounded bg-violet-first text-white text-center rounded-full">
          <p><fa-icon class="mr-2" [icon]="faCrown"></fa-icon>{{me.role}}</p>
        </span>
        <span class="mb-2 text-sm md:text-md lg:text-lg font-normal main-violet-first-rounded bg-violet-first text-white text-center rounded-full">
          <p><fa-icon class="mr-2" [icon]="faCalendar"></fa-icon>
            {{moment(Date.now()).diff(me.birth_date,"years")}} {{"OLD_YEARS"|translate}}
            ({{moment(me.birth_date).format("DD/MM/yyyy")}})
          </p>
        </span>
        <span class="mb-2 text-sm md:text-md lg:text-lg font-normal main-violet-first-rounded bg-violet-first text-white text-center rounded-full">
          <p><fa-icon class="mr-2" [icon]="faEnvelope"></fa-icon>
            {{me.email}}
          </p>
        </span>
        <span class="mb-2 text-sm md:text-md lg:text-lg font-normal main-violet-first-rounded bg-violet-first text-white text-center rounded-full">
          <p><fa-icon class="mr-2" [icon]="faPhone"></fa-icon>
            {{me.phone}}
          </p>
        </span>
        <span class="mb-2 text-sm md:text-md lg:text-lg font-normal main-violet-first-rounded bg-violet-first text-white text-center rounded-full" *ngIf="me.gender">
          <p><fa-icon class="mr-2" [icon]="faVenusMars"></fa-icon>
            {{me.gender | globalTranslate:"title": translate.currentLang}}
          </p>
        </span>
        <div class="text-right my-2">
          <a (click)="openDialog('change-profile')"
            class="cursor-pointer text-white bg-blue-500 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center mr-2 mb-2 dark:bg-blue-500 dark:hover:bg-blue-700 dark:focus:ring-blue-700">
            <fa-icon class="mr-1 text-white" [icon]="faPencilAlt"></fa-icon>
            {{"EDIT"|translate}}
          </a>
        </div>
      </div>
    </div>
    <div class="col-span-12 lg:col-span-12 xl:col-span-8 2xl:col-span-9 my-4">
      <div class="wrapper" *ngIf="subscriptions.length > 0">
        <div *ngIf="basicSubscriptions.length > 0"
             class="mb-4 w-full flex flex-col rounded-lg bg-white shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] md:flex-row">
          <img
            class="mobile:mx-auto sm:mx-auto md:mx-0 h-[150px] w-[150px] rounded-t-lg object-cover md:!rounded-none md:!rounded-l-lg"
            src="/assets/images/basic_plan.webp"
            alt="" />
          <div class="flex flex-col justify-start p-6">
            <h5
              class="mb-2 text-xl font-medium text-neutral-800">
              Basic Plan (990 тг)
            </h5>
            <ul>
              <li *ngFor="let sub of basicSubscriptions">
                <span [innerHTML]="getSubjectName(getSubjectIDFromTag(sub.tag), this.translate.currentLang)"></span>
                <span class="mx-3">({{moment(sub.ends_at).format('DD.MM.YYYY')}})</span>
              </li>
            </ul>
          </div>
        </div>
        <div *ngIf="standardSubscriptions.length > 0"
             class="mb-4 w-full flex flex-col rounded-lg bg-white shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] md:flex-row">
          <img
            class="mobile:mx-auto sm:mx-auto md:mx-0 h-[150px] w-[150px] rounded-t-lg object-cover md:!rounded-none md:!rounded-l-lg"
            src="/assets/images/standard_plan.webp"
            alt="" />
          <div class="flex flex-col justify-start p-6">
            <h5
              class="mb-2 text-xl font-medium text-neutral-800">
              Standard Plan (2490 тг)
            </h5>
            <ul>
              <li *ngFor="let sub of standardSubscriptions | keys">
                <span [innerHTML]="getSubjectName(getSubjectIDFromTag(sub.value.tag), this.translate.currentLang)"></span>
                <span class="mx-3">({{moment(sub.value.ends_at).format('DD.MM.YYYY')}})</span>
              </li>
            </ul>
          </div>
        </div>
        <div *ngIf="premiumSubscriptions.length > 0"
             class="mb-4 w-full flex flex-col rounded-lg bg-white shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] md:flex-row">
          <img
            class="mobile:mx-auto sm:mx-auto md:mx-0 h-[150px] w-[150px] rounded-t-lg object-cover md:!rounded-none md:!rounded-l-lg"
            src="/assets/images/premium_plan.webp"
            alt="" />
          <div class="flex flex-col justify-start p-6">
            <h5
              class="mb-2 text-xl font-medium text-neutral-800">
              Premium Plan (4990 тг)
            </h5>
            <ul>
              <li *ngFor="let sub of premiumSubscriptions | keys">
                <span [innerHTML]="getSubjectName(getSubjectIDFromTag(sub.value.tag), this.translate.currentLang)"></span>
                <span class="mx-3">({{moment(sub.value.ends_at).format('DD.MM.YYYY')}})</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="my-2">
        <h1>Мои заказы</h1>
        <ul class="responsive-table" *ngIf="myOrders">
          <li class="table-header">
            <div class="col col-1">№</div>
            <div class="col col-2">Номер заказа</div>
            <div class="col col-2 text-center">Сумма</div>
            <div class="col col-2">Описание</div>
            <div class="col col-2 text-center">Дата покупки</div>
<!--            <div class="col col-2">Предметы</div>-->
            <div class="col col-2 text-center">Статус</div>
          </li>
          <li class="table-row"
              *ngFor="let order of myOrders.data | paginate: {itemsPerPage: myOrders.per_page, currentPage: myOrders.current_page, totalItems: myOrders.total} | keys: requestData.page : myOrders.per_page">
            <div class="col col-1" data-label="№">
              {{parseInt(order.key) + 1}}
            </div>
            <div class="col col-2 break-all" [attr.data-label]="'NAME'|translate">{{order.value.order_id}}</div>
            <div class="col col-2 text-center break-all" [attr.data-label]="'NAME'|translate">{{order.value.price}}</div>
            <div class="col col-2 break-all" [attr.data-label]="'EMAIL'|translate">{{order.value.description}}</div>
            <div class="col col-2 text-center break-all" [attr.data-label]="'EMAIL'|translate">{{moment(order.value.created_at).format('DD.MM.YYYY')}}</div>
<!--            <div class="col col-2 break-all" [attr.data-label]="'EMAIL'|translate">-->
<!--              <span *ngFor="let subject of order.value.subjects">-->
<!--                <p>{{getSubjectName(subject, translate.currentLang)}}</p>-->
<!--              </span>-->
<!--            </div>-->
            <div class="col col-2 text-center break-all" [attr.data-label]="'BALANCE'|translate" [innerHTML]="order.value.status == 1 ? '<span>Успешно</span>' : 'Ошибка'"></div>
          </li>
        </ul>
        <div *ngIf="myOrders">
          <div class="col-span-12 my-2 flex justify-center" *ngIf="myOrders.total > myOrders.per_page">
            <pagination-controls class="rounded-full" (pageChange)="pageChanged($event)"></pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ngx-smart-modal identifier="change-profile">
  <div *ngIf="me" class="px-3 py-4">
    <form [formGroup]="profile_form" (ngSubmit)="update()">
      <core-input>
        <div class="mt-2.5 mr-0 mb-0 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'NAME' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                    <span class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                      <fa-icon [icon]="faUser"></fa-icon>
                    </span>
            <input showError name="name" [controlName]="'NAME' | translate" [formControlName]="'name'" type="text" placeholder="Jack Sparrow" class="focus:ring-indigo-500 focus:border-indigo-500
                  sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <core-input>
        <div class="mt-2.5 mr-0 mb-2.5 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'PHONE' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                    <span class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                      <fa-icon [icon]="faPhone"></fa-icon>
                    </span>
            <input showError name="phone" [controlName]="'PHONE' | translate" [formControlName]="'phone'" [inputMask]="phone_mask" type="text" placeholder="+7 777 777 7777" class="focus:ring-indigo-500 focus:border-indigo-500
                  sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <core-input>
        <div class="mt-2.5 mr-0 mb-2.5 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'BIRTH_DAY' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                    <span class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                      <fa-icon [icon]="faCalendar"></fa-icon>
                    </span>
            <input showError name="phone" [controlName]="'OLD_YEARS' | translate" [formControlName]="'date'" type="date" [placeholder]="'OLD_YEARS'|translate" class="focus:ring-indigo-500 focus:border-indigo-500
                  sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <core-input>
        <div class="mt-2.5 mr-0 mb-2.5 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'PASSWORD' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                    <span class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                      <fa-icon [icon]="faKey"></fa-icon>
                    </span>
            <input showError name="password" [controlName]="'PASSWORD' | translate" [formControlName]="'password'" type="password" placeholder="********" class="focus:ring-indigo-500 focus:border-indigo-500
                  sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <core-input>
        <div class="mt-2.5 mr-0 mb-0 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'PARENT_NAME' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                            <span
                              class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                              <fa-icon [icon]="faUser"></fa-icon>
                            </span>
            <input showError [controlName]="'PARENT_NAME' | translate" [formControlName]="'parent_name'" type="text"
                   placeholder="Jack Sparrow" class="focus:ring-indigo-500 focus:border-indigo-500
                          sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <core-input>
        <div class="mt-2.5 mr-0 mb-2.5 ml-0">
          <label class="block text-sm font-medium text-gray-700">{{'PARENT_PHONE' | translate}}</label>
          <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                            <span
                              class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                              <fa-icon [icon]="faPhone"></fa-icon>
                            </span>
            <input showError [controlName]="'PARENT_PHONE' | translate" [formControlName]="'parent_phone'"
                   [inputMask]="phone_mask" type="text" placeholder="+7 777 777 7777" class="focus:ring-indigo-500 focus:border-indigo-500
                          sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md"/>
          </div>
        </div>
      </core-input>
      <div class="mt-2.5 mr-0 mb-2.5 ml-0">
        <label class="block text-sm font-medium text-gray-700">{{'PARENT_PHONE' | translate}}</label>
        <div class="mt-1 mr-0 mb-0 ml-0 rounded-md shadow-sm relative">
                            <span
                              class="flex absolute inset-y-0 left-0 pl-3 items-center pointer-events-none text-gray-400">
                              <fa-icon [icon]="faVenusMars"></fa-icon>
                            </span>
          <select class="focus:ring-indigo-500 focus:border-indigo-500
                          sm:text-sm w-full h-10 block border-gray-300 border shadow-sm pt-0 pr-0 pb-0 pl-10 rounded-md" [formControlName]="'gender'">
            <option value="1">{{'MALE' | translate}}</option>
            <option value="2">{{'FEMALE' | translate}}</option>
          </select>
        </div>
      </div>

      <div class="text-right my-2">
        <button type="submit"
                [disabled]="!profile_form.valid"
                [ngClass]="profile_form.valid ? 'cursor-pointer' : 'cursor-not-allowed'"
          class="text-white bg-blue-500 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center mr-2 mb-2 dark:bg-blue-500 dark:hover:bg-blue-700 dark:focus:ring-blue-700">
          <fa-icon class="mr-1 text-white" [icon]="faPencilAlt"></fa-icon>
          {{"UPDATE_BUTTON"|translate}}
        </button>
      </div>
    </form>
  </div>
</ngx-smart-modal>
